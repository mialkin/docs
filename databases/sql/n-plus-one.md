# N + 1 query problem. Natural, surrogate key

## N + 1 query problem

The **N + 1 query problem** is a performance issue that occurs in database-driven applications, particularly when using ORM frameworks.

It happens when the application needs to load a collection of related data, and instead of fetching all the necessary data in a single query, it executes one query to retrieve a list of items (N queries) and then executes additional queries to fetch related data for each item in the list (1 query per item). This results in a total of N + 1 queries.

Imagine you want to display a list of recent orders and for each order show customer name and email. Let's say you fetch 10 orders from the database:

```sql
SELECT * FROM orders LIMIT 10;
```

Then for each order, you fetch its customer:

```sql
SELECT * FROM customers WHERE id = 1;
SELECT * FROM customers WHERE id = 5;
SELECT * FROM customers WHERE id = 3;
...
```

This is called the N + 1 problem: 1 query to fetch the parent records, N queries to fetch related records

## Natural, surrogate key

A **natural key** is a type of unique key in a database formed of attributes that exist and are used in the external world outside the database, for example in the business domain.

Usage of natural keys as unique identifiers in a table has one main disadvantage which is the change of business rules or the change of rules of the attribute in the real world. For example if there is a table storing the information about US citizens, the SSN would act as the natural key. If the US government changes the structure of the SSN and increases the number of digits in the SSN due to some reason.

A **surrogate key** in a database is a unique identifier for either an entity in the modeled world or an object in the database. The surrogate key is not derived from application data, unlike a natural key.

In a current database, the surrogate key can be the primary key, generated by the database management system and not derived from any application data in the database. The only significance of the surrogate key is to act as the primary key.
